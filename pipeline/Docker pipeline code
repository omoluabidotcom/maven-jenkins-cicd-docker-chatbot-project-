pipeline {
  agent any

  environment {
    IMAGE_NAME = 'springai-3.5.4'
  }

  stages {

    stage('Clone') {
      steps {
        git branch: 'main',
            credentialsId: 'github-secret',
            url: 'https://github.com/omoluabidotcom/maven-jenkins-cicd-docker-chatbot-project-.git'
      }
    }

    stage('Maven Build') {
      steps {
        sh 'mvn clean install -pl webapp -am'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t $IMAGE_NAME .'
      }
    }

    stage('Run Container') {
      steps {
        sh '''
        docker rm -f java-webapp-container || true
        docker run -d -p 80:8080 --name java-webapp-container $IMAGE_NAME
        '''
      }
    }

  }
}
